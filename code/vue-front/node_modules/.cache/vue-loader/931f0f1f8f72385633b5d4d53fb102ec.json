{"remainingRequest":"D:\\0javaproject\\code\\vue-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\0javaproject\\code\\vue-front\\src\\pages\\pay.vue?vue&type=style&index=0&id=509ab9d4&lang=scss&scoped=true","dependencies":[{"path":"D:\\0javaproject\\code\\vue-front\\src\\pages\\pay.vue","mtime":1743919381358},{"path":"D:\\0javaproject\\code\\vue-front\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\0javaproject\\code\\vue-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\0javaproject\\code\\vue-front\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\0javaproject\\code\\vue-front\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\0javaproject\\code\\vue-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\0javaproject\\code\\vue-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5jb250YWluZXIgewogIG1hcmdpbjogMTBweDsKICBmb250LXNpemU6IDE0cHg7CiAgc3BhbiB7CiAgICB3aWR0aDogNjBweDsKICB9CiAgLnRvcC1jb250ZW50IHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgcGFkZGluZzogMjBweDsKICB9CiAgLnByaWNlLWNvbnRlbnQgewogICAgZGlzcGxheTogZmxleDsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICBtYXJnaW4tdG9wOiAyMHB4OwogICAgcGFkZGluZy1ib3R0b206IDIwcHg7CiAgICBwYWRkaW5nOiAyMHB4OwogICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlZWVlZWU7CiAgICBmb250LXNpemU6IDIwcHg7CiAgICBmb250LXdlaWdodDogYm9sZDsKICAgIGNvbG9yOiByZWQ7CiAgfQogIC5wYXktdHlwZS1jb250ZW50IHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgbWFyZ2luLXRvcDogMjBweDsKICAgIGZsZXgtd3JhcDogd3JhcDsKICAgIHNwYW4gewogICAgICB3aWR0aDogMTAwcHg7CiAgICB9CiAgICAucGF5LXR5cGUtaXRlbSB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIHdpZHRoOiAzMDBweDsKICAgICAgbWFyZ2luOiAyMHB4OwogICAgICBib3JkZXI6IDFweCBzb2xpZCAjZWVlZWVlOwogICAgICBwYWRkaW5nOiAyMHB4OwogICAgICBjdXJzb3I6IHBvaW50ZXI7CgogICAgICBpbWcgewogICAgICAgIGhlaWdodDogNDBweDsKICAgICAgICBtYXJnaW4tbGVmdDogMTBweDsKICAgICAgfQogICAgfQogIH0KICAuYnV0b24tY29udGVudCB7CiAgICBtYXJnaW46IDIwcHg7CiAgfQogIC5xci1jb2RlLWNvbnRhaW5lciB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgbWluLWhlaWdodDogMzAwcHg7CiAgICAucXItY29kZSB7CiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgCiAgICAgIGltZyB7CiAgICAgICAgd2lkdGg6IDIwMHB4OwogICAgICAgIGhlaWdodDogMjAwcHg7CiAgICAgIH0KICAgIH0KICB9CiAgLnFyLWNvZGUtdGlwcyB7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICBtYXJnaW46IDIwcHggMDsKICAgIGNvbG9yOiAjNjY2OwogICAgcCB7CiAgICAgIG1hcmdpbjogNXB4IDA7CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["pay.vue"],"names":[],"mappings":";AAiMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"pay.vue","sourceRoot":"src/pages","sourcesContent":["<template>\n  <div class=\"container\"  :style='{\"margin\":\"0 200px 20px\"}' style=\"padding: 150px 0;\">\n    <el-alert title=\"确认支付前请先核对订单信息\" type=\"success\" :closable=\"false\"></el-alert>\n    <!-- <div class=\"top-content\">\n      <span>收款人</span>\n      <el-input style=\"width:300px\" v-model=\"name\" placeholder=\"收款人\"></el-input>\n      <span style=\"margin-left:20px\">收款账号</span>\n      <el-input style=\"width:300px\" v-model=\"account\" placeholder=\"收款账号\"></el-input>\n    </div> -->\n    <!-- <div class=\"price-content\">\n      <span>金额</span>\n      <span>￥99.0</span>\n    </div> -->\n    <div class=\"pay-type-content\">\n      <div class=\"pay-type-item\" v-for=\"(item, index) in payTypes\" :key=\"index\">\n        <el-radio v-model=\"type\" :label=\"item.label\">\n          <img :src=\"item.icon\" :alt=\"item.label\">\n        </el-radio>\n      </div>\n    </div>\n    <div class=\"buton-content\">\n      <el-button @click=\"submitTap\" type=\"primary\">确认支付</el-button>\n      <el-button @click=\"back()\">返回</el-button>\n    </div>\n\n    <!-- 支付宝二维码支付弹窗 -->\n    <el-dialog\n      title=\"支付宝扫码支付\"\n      :visible.sync=\"qrCodeDialogVisible\"\n      width=\"400px\"\n      :close-on-click-modal=\"false\"\n      center>\n      <div class=\"qr-code-container\">\n        <div v-if=\"qrCodeUrl\" class=\"qr-code\">\n          <img :src=\"qrCodeUrl\" alt=\"支付宝支付二维码\">\n        </div>\n        <div v-else class=\"loading\">\n          <el-loading></el-loading>\n        </div>\n      </div>\n      <div class=\"qr-code-tips\">\n        <p>请使用支付宝扫描二维码完成支付</p>\n        <p>支付完成后将自动跳转</p>\n      </div>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"cancelPay\">取消支付</el-button>\n        <el-button type=\"primary\" @click=\"checkPayStatus\">已完成支付</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n<script>\n// import { Message } from \"element-ui\";\nexport default {\n  data() {\n    return {\n      name: \"\",\n      account: \"\",\n      type: \"\",\n      table: \"\",\n      obj: \"\",\n      qrCodeDialogVisible: false,\n      qrCodeUrl: \"\",\n      payTimer: null,\n      payTypes: [\n        {\n          label: \"支付宝支付\",\n          icon: require(\"@/assets/zhifubao.png\")\n        },\n        {\n          label: \"微信支付\",\n          icon: require(\"@/assets/weixin.png\")\n        },\n        {\n          label: \"建设银行\",\n          icon: require(\"@/assets/jianshe.png\")\n        },\n        {\n          label: \"农业银行\",\n          icon: require(\"@/assets/nongye.png\")\n        },\n        {\n          label: \"中国银行\",\n          icon: require(\"@/assets/zhongguo.png\")\n        },\n        {\n          label: \"交通银行\",\n          icon: require(\"@/assets/jiaotong.png\")\n        }\n      ]\n    };\n  },\n  mounted() {\n    let table = localStorage.getItem(\"paytable\");\n    let obj = JSON.parse(localStorage.getItem(\"payObject\"));\n    this.table = table;\n    this.obj = obj;\n  },\n  beforeDestroy() {\n    this.clearPayTimer();\n  },\n  methods: {\n    submitTap() {\n      if (!this.type) {\n        this.$message.error(\"请选择支付方式\");\n        return;\n      }\n      this.$confirm(`确定支付?`, \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\"\n      }).then(() => {\n        if (this.type === \"支付宝支付\") {\n          // 调用支付宝二维码支付接口\n          this.qrCodeDialogVisible = true;\n          this.qrCodeUrl = '';  // 清空之前的二维码\n          \n          this.$http.post('/api/alipay/createQrCode', {\n            orderId: this.obj.id,\n            amount: this.obj.amount,\n            subject: \"订单支付\"\n          }).then(res => {\n            if (res.data && res.data.code === 0) {\n              this.qrCodeUrl = res.data.qrCode;\n              this.startCheckPayStatus();\n            } else {\n              this.$message.error(res.data.msg);\n              this.qrCodeDialogVisible = false;\n            }\n          });\n        } else {\n          // 其他支付方式的处理逻辑\n          this.obj.payStatus = \"已支付\";\n          this.$http.post(`${this.table}/update`,this.obj).then(res => {\n            if (res.data && res.data.code === 0) {\n              this.$message({\n                message: \"支付成功\",\n                type: \"success\",\n                duration: 1500,\n                onClose: () => {\n                  this.$router.go(-1);\n                }\n              });\n            } else {\n              this.$message.error(res.data.msg);\n            }\n          });\n        }\n      });\n    },\n    startCheckPayStatus() {\n      this.clearPayTimer();\n      // 每3秒检查一次支付状态\n      this.payTimer = setInterval(() => {\n        this.checkPayStatus();\n      }, 3000);\n    },\n    checkPayStatus() {\n      this.$http.get(`${this.table}/info/${this.obj.id}`).then(res => {\n        if (res.data && res.data.code === 0) {\n          if (res.data.data.payStatus === \"已支付\") {\n            this.clearPayTimer();\n            this.qrCodeDialogVisible = false;\n            this.$message({\n              message: \"支付成功\",\n              type: \"success\",\n              duration: 1500,\n              onClose: () => {\n                this.$router.go(-1);\n              }\n            });\n          }\n        }\n      });\n    },\n    cancelPay() {\n      this.clearPayTimer();\n      this.qrCodeDialogVisible = false;\n    },\n    clearPayTimer() {\n      if (this.payTimer) {\n        clearInterval(this.payTimer);\n        this.payTimer = null;\n      }\n    },\n    back() {\n      this.clearPayTimer();\n      this.$router.go(-1);\n    }\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n.container {\n  margin: 10px;\n  font-size: 14px;\n  span {\n    width: 60px;\n  }\n  .top-content {\n    display: flex;\n    align-items: center;\n    padding: 20px;\n  }\n  .price-content {\n    display: flex;\n    align-items: center;\n    margin-top: 20px;\n    padding-bottom: 20px;\n    padding: 20px;\n    border-bottom: 1px solid #eeeeee;\n    font-size: 20px;\n    font-weight: bold;\n    color: red;\n  }\n  .pay-type-content {\n    display: flex;\n    align-items: center;\n    margin-top: 20px;\n    flex-wrap: wrap;\n    span {\n      width: 100px;\n    }\n    .pay-type-item {\n      display: flex;\n      align-items: center;\n      width: 300px;\n      margin: 20px;\n      border: 1px solid #eeeeee;\n      padding: 20px;\n      cursor: pointer;\n\n      img {\n        height: 40px;\n        margin-left: 10px;\n      }\n    }\n  }\n  .buton-content {\n    margin: 20px;\n  }\n  .qr-code-container {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    min-height: 300px;\n    .qr-code {\n      text-align: center;\n      \n      img {\n        width: 200px;\n        height: 200px;\n      }\n    }\n  }\n  .qr-code-tips {\n    text-align: center;\n    margin: 20px 0;\n    color: #666;\n    p {\n      margin: 5px 0;\n    }\n  }\n}\n</style>\n"]}]}