{"remainingRequest":"D:\\0javaproject\\code\\vue-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\0javaproject\\code\\vue-front\\src\\pages\\login\\login.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\0javaproject\\code\\vue-front\\src\\pages\\login\\login.vue","mtime":1742990562758},{"path":"D:\\0javaproject\\code\\vue-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\0javaproject\\code\\vue-front\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\0javaproject\\code\\vue-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\0javaproject\\code\\vue-front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgbWVudSBmcm9tICdAL2NvbmZpZy9tZW51Jw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGJhc2VVcmw6IHRoaXMuJGNvbmZpZy5iYXNlVXJsLA0KICAgICAgbG9naW5UeXBlOiAxLA0KICAgICAgcm9sZU1lbnVzOiBbXSwNCiAgICAgIGxvZ2luRm9ybTogew0KICAgICAgICB1c2VybmFtZTogJycsDQogICAgICAgIHBhc3N3b3JkOiAnJywNCiAgICAgICAgdGFibGVOYW1lOiAnJywNCiAgICAgICAgY29kZTogJycsIC8vIOiLpeWQjue7remcgOimgeaPkOS6pOmqjOivgeegge+8jOatpOWtl+auteWPr+S9v+eUqA0KICAgICAgfSwNCiAgICAgIHJvbGU6ICcnLA0KICAgICAgcm9sZXM6IFtdLA0KICAgICAgcnVsZXM6IHsNCiAgICAgICAgdXNlcm5hbWU6IFsNCiAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+36L6T5YWl6LSm5Y+3JywgdHJpZ2dlcjogJ2JsdXInIH0NCiAgICAgICAgXSwNCiAgICAgICAgcGFzc3dvcmQ6IFsNCiAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+36L6T5YWl5a+G56CBJywgdHJpZ2dlcjogJ2JsdXInIH0NCiAgICAgICAgXQ0KICAgICAgfSwNCiAgICAgIC8vIOaWsOWinuWtl+aute+8muiusOW9lei/nue7reeZu+W9leWksei0peasoeaVsOOAgemqjOivgeeggeaWh+acrOOAgeeUqOaIt+i+k+WFpeeahOmqjOivgeeggQ0KICAgICAgbG9naW5FcnJvckNvdW50OiAwLA0KICAgICAgY2FwdGNoYTogJycsDQogICAgICBjYXB0Y2hhSW5wdXQ6ICcnDQogICAgfQ0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIC8vIOinkuiJsuS/oeaBrw0KICAgIHRoaXMucm9sZU1lbnVzID0gbWVudS5saXN0KCkNCiAgICBmb3IgKGxldCBpdGVtIGluIHRoaXMucm9sZU1lbnVzKSB7DQogICAgICBpZiAodGhpcy5yb2xlTWVudXNbaXRlbV0uaGFzRnJvbnRMb2dpbiA9PT0gJ+aYrycpIHsNCiAgICAgICAgdGhpcy5yb2xlcy5wdXNoKHRoaXMucm9sZU1lbnVzW2l0ZW1dKQ0KICAgICAgfQ0KICAgIH0NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIHNlbGVjdENoYW5nZShlKSB7DQogICAgICBmb3IgKGxldCB4IGluIHRoaXMucm9sZXMpIHsNCiAgICAgICAgaWYgKHRoaXMucm9sZXNbeF0udGFibGVOYW1lID09PSBlKSB7DQogICAgICAgICAgdGhpcy5yb2xlID0gdGhpcy5yb2xlc1t4XS5yb2xlTmFtZQ0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICAvLyDnlJ/miJDkuIDkuKo05L2N6ZqP5py66aqM6K+B56CB77yM5bm257uY5Yi25bim5bmy5omw6aG555qE5Zu+5b2i6aqM6K+B56CBDQogICAgZ2VuZXJhdGVDYXB0Y2hhKCkgew0KICAgICAgY29uc3QgY2hhcnMgPSAnQUJDREVGR0hKS01OUFFSU1RVVldYWVphYmNkZWZnaGprbW5wcXJzdHV2d3h5ejIzNDU2Nzg5Jw0KICAgICAgbGV0IHJlc3VsdCA9ICcnDQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgew0KICAgICAgICByZXN1bHQgKz0gY2hhcnMuY2hhckF0KE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNoYXJzLmxlbmd0aCkpDQogICAgICB9DQogICAgICB0aGlzLmNhcHRjaGEgPSByZXN1bHQNCiAgICAgIHRoaXMuZHJhd0NhcHRjaGEoKQ0KICAgICAgdGhpcy5jYXB0Y2hhSW5wdXQgPSAnJw0KICAgIH0sDQogICAgLy8g5Yip55SoQ2FudmFz57uY5Yi26aqM6K+B56CB5Y+K5bmy5omw6aG5DQogICAgZHJhd0NhcHRjaGEoKSB7DQogICAgICBjb25zdCBjYW52YXMgPSB0aGlzLiRyZWZzLmNhcHRjaGFDYW52YXMNCiAgICAgIGlmICghY2FudmFzKSByZXR1cm4NCiAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpDQogICAgICBjb25zdCB3aWR0aCA9IGNhbnZhcy53aWR0aA0KICAgICAgY29uc3QgaGVpZ2h0ID0gY2FudmFzLmhlaWdodA0KICAgICAgLy8g5riF6Zmk55S75biDDQogICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpDQogICAgICAvLyDnu5jliLbog4zmma8NCiAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2YwZjBmMCcNCiAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KQ0KICAgICAgLy8g57uY5Yi26aqM6K+B56CB5a2X56ymDQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY2FwdGNoYS5sZW5ndGg7IGkrKykgew0KICAgICAgICBjb25zdCBjaGFyID0gdGhpcy5jYXB0Y2hhW2ldDQogICAgICAgIGNvbnN0IGZvbnRTaXplID0gMjAgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCkNCiAgICAgICAgY29uc3QgYW5nbGUgPSBNYXRoLnJhbmRvbSgpICogMzAgKiBNYXRoLlBJIC8gMTgwDQogICAgICAgIGN0eC5mb250ID0gYCR7Zm9udFNpemV9cHggQXJpYWxgDQogICAgICAgIGN0eC5maWxsU3R5bGUgPSBgcmdiKCR7TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKjEwMCl9LCAke01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoxMDApfSwgJHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMTAwKX0pYA0KICAgICAgICBjdHguc2F2ZSgpDQogICAgICAgIGNvbnN0IHggPSAxMCArIGkgKiAyNQ0KICAgICAgICBjb25zdCB5ID0gMjUgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCkNCiAgICAgICAgY3R4LnRyYW5zbGF0ZSh4LCB5KQ0KICAgICAgICBjdHgucm90YXRlKGFuZ2xlKQ0KICAgICAgICBjdHguZmlsbFRleHQoY2hhciwgMCwgMCkNCiAgICAgICAgY3R4LnJlc3RvcmUoKQ0KICAgICAgfQ0KICAgICAgLy8g57uY5Yi25bmy5omw57q/DQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykgew0KICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBgcmdiKCR7TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKjI1NSl9LCAke01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoyNTUpfSwgJHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMjU1KX0pYA0KICAgICAgICBjdHguYmVnaW5QYXRoKCkNCiAgICAgICAgY3R4Lm1vdmVUbyhNYXRoLnJhbmRvbSgpICogd2lkdGgsIE1hdGgucmFuZG9tKCkgKiBoZWlnaHQpDQogICAgICAgIGN0eC5saW5lVG8oTWF0aC5yYW5kb20oKSAqIHdpZHRoLCBNYXRoLnJhbmRvbSgpICogaGVpZ2h0KQ0KICAgICAgICBjdHguc3Ryb2tlKCkNCiAgICAgIH0NCiAgICAgIC8vIOe7mOWItuW5suaJsOeCuQ0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzMDsgaSsrKSB7DQogICAgICAgIGN0eC5maWxsU3R5bGUgPSBgcmdiKCR7TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKjI1NSl9LCAke01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSoyNTUpfSwgJHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMjU1KX0pYA0KICAgICAgICBjb25zdCB4ID0gTWF0aC5yYW5kb20oKSAqIHdpZHRoDQogICAgICAgIGNvbnN0IHkgPSBNYXRoLnJhbmRvbSgpICogaGVpZ2h0DQogICAgICAgIGN0eC5iZWdpblBhdGgoKQ0KICAgICAgICBjdHguYXJjKHgsIHksIDEsIDAsIDIgKiBNYXRoLlBJKQ0KICAgICAgICBjdHguZmlsbCgpDQogICAgICB9DQogICAgfSwNCiAgICBzdWJtaXRGb3JtKGZvcm1OYW1lKSB7DQogICAgICBpZiAodGhpcy5yb2xlcy5sZW5ndGggIT09IDEpIHsNCiAgICAgICAgaWYgKCF0aGlzLnJvbGUpIHsNCiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfor7fpgInmi6nnmbvlvZXnlKjmiLfnsbvlnosnKQ0KICAgICAgICAgIHJldHVybg0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLnJvbGUgPSB0aGlzLnJvbGVzWzBdLnJvbGVOYW1lDQogICAgICAgIHRoaXMubG9naW5Gb3JtLnRhYmxlTmFtZSA9IHRoaXMucm9sZXNbMF0udGFibGVOYW1lDQogICAgICB9DQogICAgICAvLyDlvZPov57nu63ovpPplJkz5qyh5ZCO5qCh6aqM6aqM6K+B56CBDQogICAgICBpZiAodGhpcy5sb2dpbkVycm9yQ291bnQgPj0gMykgew0KICAgICAgICBpZiAoIXRoaXMuY2FwdGNoYUlucHV0KSB7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign6K+36L6T5YWl6aqM6K+B56CBJykNCiAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KICAgICAgICBpZiAodGhpcy5jYXB0Y2hhSW5wdXQudG9Mb3dlckNhc2UoKSAhPT0gdGhpcy5jYXB0Y2hhLnRvTG93ZXJDYXNlKCkpIHsNCiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCfpqozor4HnoIHplJnor6/vvIzor7fph43mlrDovpPlhaUnKQ0KICAgICAgICAgIHRoaXMuZ2VuZXJhdGVDYXB0Y2hhKCkNCiAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgdGhpcy4kcmVmc1tmb3JtTmFtZV0udmFsaWRhdGUoKHZhbGlkKSA9PiB7DQogICAgICAgIGlmICh2YWxpZCkgew0KICAgICAgICAgIHRoaXMuJGh0dHANCiAgICAgICAgICAgICAgLmdldChgJHt0aGlzLmxvZ2luRm9ybS50YWJsZU5hbWV9L2xvZ2luYCwgeyBwYXJhbXM6IHRoaXMubG9naW5Gb3JtIH0pDQogICAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsNCiAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGEuY29kZSA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2Zyb250VG9rZW4nLCByZXMuZGF0YS50b2tlbikNCiAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdVc2VyVGFibGVOYW1lJywgdGhpcy5sb2dpbkZvcm0udGFibGVOYW1lKQ0KICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3VzZXJuYW1lJywgdGhpcy5sb2dpbkZvcm0udXNlcm5hbWUpDQogICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZnJvbnRTZXNzaW9uVGFibGUnLCB0aGlzLmxvZ2luRm9ybS50YWJsZU5hbWUpDQogICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZnJvbnRSb2xlJywgdGhpcy5yb2xlKQ0KICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2tleVBhdGgnLCAwKQ0KICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy8nKQ0KICAgICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCfnmbvlvZXmiJDlip8nKQ0KICAgICAgICAgICAgICAgICAgLy8g55m75b2V5oiQ5Yqf5ZCO6YeN572u6ZSZ6K+v6K6h5pWw5Y+K6aqM6K+B56CB5pWw5o2uDQogICAgICAgICAgICAgICAgICB0aGlzLmxvZ2luRXJyb3JDb3VudCA9IDANCiAgICAgICAgICAgICAgICAgIHRoaXMuY2FwdGNoYSA9ICcnDQogICAgICAgICAgICAgICAgICB0aGlzLmNhcHRjaGFJbnB1dCA9ICcnDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLmRhdGEubXNnKQ0KICAgICAgICAgICAgICAgICAgLy8g55m75b2V5aSx6LSl77yM57Sv6K6h6ZSZ6K+v5qyh5pWw77yb6L6+5YiwM+asoeaXtueUn+aIkOmqjOivgeeggQ0KICAgICAgICAgICAgICAgICAgdGhpcy5sb2dpbkVycm9yQ291bnQrKw0KICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubG9naW5FcnJvckNvdW50ID09PSAzKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVDYXB0Y2hhKCkNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcmV0dXJuIGZhbHNlDQogICAgICAgIH0NCiAgICAgIH0pDQogICAgfQ0KICB9LA0KfQ0K"},{"version":3,"sources":["login.vue"],"names":[],"mappings":";AAoHA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"login.vue","sourceRoot":"src/pages/login","sourcesContent":["<template>\r\n  <div class=\"login-page\">\r\n    <!-- 左侧插画区域 -->\r\n    <div class=\"login-left\">\r\n      <img\r\n          class=\"login-illustration\"\r\n          src=\"https://cdn.prod.website-files.com/6364b6fd26e298b0b8b938f5/6364b6fd26e2987e0cb93a02_reset%20password.png\"\r\n          alt=\"Illustration\"\r\n      />\r\n    </div>\r\n\r\n    <!-- 右侧表单区域 -->\r\n    <div class=\"login-right\">\r\n      <!-- 再嵌套一层容器，以便灵活调整表单位置/宽度 -->\r\n      <div class=\"form-container\">\r\n        <el-form\r\n            ref=\"loginForm\"\r\n            :model=\"loginForm\"\r\n            :rules=\"rules\"\r\n            class=\"login-form\"\r\n        >\r\n          <!-- 标题 -->\r\n          <h2 class=\"login-title\">欢迎回来，别来无恙啊!</h2>\r\n          <p class=\"login-subtitle\">基于Java的个人摄影管理网站</p>\r\n\r\n          <!-- 用户名 -->\r\n          <el-form-item prop=\"username\">\r\n            <el-input\r\n                class=\"localinput\"\r\n                v-model=\"loginForm.username\"\r\n                placeholder=\"请输入账号\"\r\n                clearable\r\n            />\r\n          </el-form-item>\r\n\r\n          <!-- 密码 -->\r\n          <el-form-item prop=\"password\">\r\n            <el-input\r\n                class=\"localinput\"\r\n                v-model=\"loginForm.password\"\r\n                type=\"password\"\r\n                placeholder=\"请输入密码\"\r\n                clearable\r\n            />\r\n          </el-form-item>\r\n\r\n          <!-- 角色选择(若需要) -->\r\n          <el-form-item v-if=\"roles.length > 1\">\r\n            <el-select\r\n                v-model=\"loginForm.tableName\"\r\n                placeholder=\"请选择角色\"\r\n                @change=\"selectChange\"\r\n                style=\"width: 100%;\"\r\n            >\r\n              <el-option\r\n                  v-for=\"(item, index) in roles\"\r\n                  :key=\"index\"\r\n                  :label=\"item.roleName\"\r\n                  :value=\"item.tableName\"\r\n              />\r\n            </el-select>\r\n          </el-form-item>\r\n\r\n          <!-- 验证码：当连续输错3次后显示 -->\r\n          <el-form-item v-if=\"loginErrorCount >= 3\">\r\n            <!-- 使用一个容器统一水平排列验证码输入框和Canvas -->\r\n            <div class=\"captcha-wrapper\">\r\n              <el-input\r\n                  class=\"authcode\"\r\n                  v-model=\"captchaInput\"\r\n                  placeholder=\"请输入验证码\"\r\n                  clearable\r\n              />\r\n              <canvas\r\n                  ref=\"captchaCanvas\"\r\n                  width=\"120\"\r\n                  height=\"40\"\r\n                  class=\"captcha-canvas\"\r\n                  @click=\"generateCaptcha\"\r\n              ></canvas>\r\n            </div>\r\n          </el-form-item>\r\n\r\n          <!-- 登录按钮 -->\r\n          <el-form-item>\r\n            <el-button\r\n                type=\"primary\"\r\n                class=\"btn-login\"\r\n                @click=\"submitForm('loginForm')\"\r\n            >\r\n              登录\r\n            </el-button>\r\n          </el-form-item>\r\n\r\n          <!-- 注册按钮(若需要) -->\r\n          <div class=\"register-links\" v-if=\"roles.length\">\r\n            <router-link\r\n                v-for=\"(item, index) in roles\"\r\n                :key=\"index\"\r\n                v-if=\"item.hasFrontRegister === '是'\"\r\n                :to=\"{ path: '/register', query: { role: item.tableName, pageFlag: 'register' } }\"\r\n                class=\"btn-register\"\r\n            >\r\n              还没有账号？点击注册{{ item.roleName.replace('注册', '') }}\r\n            </router-link>\r\n          </div>\r\n        </el-form>\r\n      </div>\r\n    </div>\r\n    <footer class=\"bottom-footer\">\r\n      @ all right reserved by  甘肃政法大学 张恒毓 2025\r\n    </footer>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport menu from '@/config/menu'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      baseUrl: this.$config.baseUrl,\r\n      loginType: 1,\r\n      roleMenus: [],\r\n      loginForm: {\r\n        username: '',\r\n        password: '',\r\n        tableName: '',\r\n        code: '', // 若后续需要提交验证码，此字段可使用\r\n      },\r\n      role: '',\r\n      roles: [],\r\n      rules: {\r\n        username: [\r\n          { required: true, message: '请输入账号', trigger: 'blur' }\r\n        ],\r\n        password: [\r\n          { required: true, message: '请输入密码', trigger: 'blur' }\r\n        ]\r\n      },\r\n      // 新增字段：记录连续登录失败次数、验证码文本、用户输入的验证码\r\n      loginErrorCount: 0,\r\n      captcha: '',\r\n      captchaInput: ''\r\n    }\r\n  },\r\n  created() {\r\n    // 角色信息\r\n    this.roleMenus = menu.list()\r\n    for (let item in this.roleMenus) {\r\n      if (this.roleMenus[item].hasFrontLogin === '是') {\r\n        this.roles.push(this.roleMenus[item])\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    selectChange(e) {\r\n      for (let x in this.roles) {\r\n        if (this.roles[x].tableName === e) {\r\n          this.role = this.roles[x].roleName\r\n        }\r\n      }\r\n    },\r\n    // 生成一个4位随机验证码，并绘制带干扰项的图形验证码\r\n    generateCaptcha() {\r\n      const chars = 'ABCDEFGHJKMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789'\r\n      let result = ''\r\n      for (let i = 0; i < 4; i++) {\r\n        result += chars.charAt(Math.floor(Math.random() * chars.length))\r\n      }\r\n      this.captcha = result\r\n      this.drawCaptcha()\r\n      this.captchaInput = ''\r\n    },\r\n    // 利用Canvas绘制验证码及干扰项\r\n    drawCaptcha() {\r\n      const canvas = this.$refs.captchaCanvas\r\n      if (!canvas) return\r\n      const ctx = canvas.getContext('2d')\r\n      const width = canvas.width\r\n      const height = canvas.height\r\n      // 清除画布\r\n      ctx.clearRect(0, 0, width, height)\r\n      // 绘制背景\r\n      ctx.fillStyle = '#f0f0f0'\r\n      ctx.fillRect(0, 0, width, height)\r\n      // 绘制验证码字符\r\n      for (let i = 0; i < this.captcha.length; i++) {\r\n        const char = this.captcha[i]\r\n        const fontSize = 20 + Math.floor(Math.random() * 10)\r\n        const angle = Math.random() * 30 * Math.PI / 180\r\n        ctx.font = `${fontSize}px Arial`\r\n        ctx.fillStyle = `rgb(${Math.floor(Math.random()*100)}, ${Math.floor(Math.random()*100)}, ${Math.floor(Math.random()*100)})`\r\n        ctx.save()\r\n        const x = 10 + i * 25\r\n        const y = 25 + Math.floor(Math.random() * 10)\r\n        ctx.translate(x, y)\r\n        ctx.rotate(angle)\r\n        ctx.fillText(char, 0, 0)\r\n        ctx.restore()\r\n      }\r\n      // 绘制干扰线\r\n      for (let i = 0; i < 5; i++) {\r\n        ctx.strokeStyle = `rgb(${Math.floor(Math.random()*255)}, ${Math.floor(Math.random()*255)}, ${Math.floor(Math.random()*255)})`\r\n        ctx.beginPath()\r\n        ctx.moveTo(Math.random() * width, Math.random() * height)\r\n        ctx.lineTo(Math.random() * width, Math.random() * height)\r\n        ctx.stroke()\r\n      }\r\n      // 绘制干扰点\r\n      for (let i = 0; i < 30; i++) {\r\n        ctx.fillStyle = `rgb(${Math.floor(Math.random()*255)}, ${Math.floor(Math.random()*255)}, ${Math.floor(Math.random()*255)})`\r\n        const x = Math.random() * width\r\n        const y = Math.random() * height\r\n        ctx.beginPath()\r\n        ctx.arc(x, y, 1, 0, 2 * Math.PI)\r\n        ctx.fill()\r\n      }\r\n    },\r\n    submitForm(formName) {\r\n      if (this.roles.length !== 1) {\r\n        if (!this.role) {\r\n          this.$message.error('请选择登录用户类型')\r\n          return\r\n        }\r\n      } else {\r\n        this.role = this.roles[0].roleName\r\n        this.loginForm.tableName = this.roles[0].tableName\r\n      }\r\n      // 当连续输错3次后校验验证码\r\n      if (this.loginErrorCount >= 3) {\r\n        if (!this.captchaInput) {\r\n          this.$message.error('请输入验证码')\r\n          return\r\n        }\r\n        if (this.captchaInput.toLowerCase() !== this.captcha.toLowerCase()) {\r\n          this.$message.error('验证码错误，请重新输入')\r\n          this.generateCaptcha()\r\n          return\r\n        }\r\n      }\r\n      this.$refs[formName].validate((valid) => {\r\n        if (valid) {\r\n          this.$http\r\n              .get(`${this.loginForm.tableName}/login`, { params: this.loginForm })\r\n              .then((res) => {\r\n                if (res.data.code === 0) {\r\n                  localStorage.setItem('frontToken', res.data.token)\r\n                  localStorage.setItem('UserTableName', this.loginForm.tableName)\r\n                  localStorage.setItem('username', this.loginForm.username)\r\n                  localStorage.setItem('frontSessionTable', this.loginForm.tableName)\r\n                  localStorage.setItem('frontRole', this.role)\r\n                  localStorage.setItem('keyPath', 0)\r\n                  this.$router.push('/')\r\n                  this.$message.success('登录成功')\r\n                  // 登录成功后重置错误计数及验证码数据\r\n                  this.loginErrorCount = 0\r\n                  this.captcha = ''\r\n                  this.captchaInput = ''\r\n                } else {\r\n                  this.$message.error(res.data.msg)\r\n                  // 登录失败，累计错误次数；达到3次时生成验证码\r\n                  this.loginErrorCount++\r\n                  if (this.loginErrorCount === 3) {\r\n                    this.generateCaptcha()\r\n                  }\r\n                }\r\n              })\r\n        } else {\r\n          return false\r\n        }\r\n      })\r\n    }\r\n  },\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.login-page {\r\n  display: flex;\r\n  min-height: 100vh;\r\n\r\n  /* 左侧插画区域 (占比6) */\r\n  .login-left {\r\n    flex: 6;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    background-color: #f8f9fa;\r\n  }\r\n\r\n  .login-illustration {\r\n    max-width: 40%;\r\n    height: auto;\r\n  }\r\n\r\n  /* 右侧表单区域 (占比4) */\r\n  .login-right {\r\n    flex: 4;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    background-color: #fff;\r\n  }\r\n\r\n  .form-container {\r\n    width: 80%;\r\n    max-width: 560px;\r\n    margin: 0 auto;\r\n  }\r\n\r\n  .login-subtitle {\r\n    margin-bottom: 150px;\r\n    font-size: 18px;\r\n    text-align: center;\r\n    color: #747474;\r\n  }\r\n  .login-form {\r\n    .login-title {\r\n      margin-top: 50px;\r\n      margin-bottom: 30px;\r\n      font-size: 40px;\r\n      font-weight: 600;\r\n      color: #333;\r\n      text-align: center;\r\n    }\r\n    // 错误标签外边框左移\r\n    .el-form-item__error{\r\n      margin-left: 120px;\r\n\r\n    .el-form-item {\r\n      margin-bottom: 30px;\r\n      .el-input__inner {\r\n        height: 44px;\r\n      }\r\n\r\n    }\r\n\r\n\r\n    }\r\n\r\n    .localinput, .authcode{\r\n      width: 300px;\r\n      border-radius: 30px;\r\n      margin-left: 120px;\r\n\r\n    }\r\n    .authcode{\r\n      width: 175px;\r\n    }\r\n    .btn-login {\r\n      width: 100px;\r\n      height: 44px;\r\n      font-size: 16px;\r\n      margin: 30px 230px;\r\n      border-radius: 30px;\r\n    }\r\n\r\n    .register-links {\r\n      margin-top: 20px;\r\n      display: flex;\r\n      flex-direction: column;\r\n\r\n      .btn-register {\r\n        margin-top: 8px;\r\n        text-align: center;\r\n        color: #909399;\r\n        text-decoration: none;\r\n\r\n        &:hover {\r\n          text-decoration: none;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n.bottom-footer {\r\n  position: absolute;\r\n  bottom: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 80px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  text-align: center;\r\n  background-color: white;\r\n  font-size: 16px;\r\n  color: #909399;\r\n  border-top: 1px solid #ddd;\r\n}\r\n\r\n///* 新增：验证码容器统一水平排列 */\r\n// 用于包裹验证码输入框和 Canvas，这样可以通过 CSS 使它们在同一行排列。\r\n.captcha-wrapper {\r\n  display: flex;\r\n  align-items: center;\r\n\r\n}\r\n\r\n.captcha-canvas {\r\n  //margin-left: 10px;\r\n  width: 125px;\r\n  height: 40px;\r\n  cursor: pointer;\r\n  border: 1px solid #ddd;\r\n}\r\n</style>\r\n"]}]}